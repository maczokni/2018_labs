{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Third_session\"\nauthor: \"Reka Solymosi (supplementing material produced as well by Juanjo Medina)\"\ndate: \"25/01/2018\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n\n#Interactive maps with Leaflet\n\nSo this is a super brief intro into some of the cool things you can do with leaflet. There are comprehensive tutorials available online, for example [here](https://rstudio.github.io/leaflet/).\n\n[Leaflet](http://leafletjs.com/) is the leading open-source JavaScript library for mobile-friendly interactive maps. It is very most popular, used by websites ranging from The New York Times and The Washington Post to GitHub and Flickr, as well as GIS specialists like OpenStreetMap, Mapbox, and CartoDB.\n\n\nIn this section of the lab we will learn how to make really flashy looking maps using leaflet. \n\nYou will need to have installed the following packages to follow along:\n\n```{r, eval=FALSE}\ninstall.packages(\"leaflet\") #for mapping\ninstall.packages(\"RColorBrewer\") #for getting nice colours for your maps\n```\n\n\nOnce you have them installed, load them up with the `library()` function:\n\n##Making a map\n\nTo make a map, just load the leaflet library:\n\n```{r}\nlibrary(leaflet)\n```\n\nYou then create a map with this simple bit of code:\n\n```{r}\nm <- leaflet() %>%\n  addTiles()  \n```\n\nAnd just print it:\n```{r}\nm  \n```\n\n##Adding some content:\n\nYou might of course want to add some content to your map. \n\n##Adding points manuall:\n\nYou can add a point manually:\n\n```{r}\nm <- leaflet() %>%\n  addTiles()  %>% \n  addMarkers(lng=-2.230899, lat=53.464987, popup=\"You are here\")\nm  \n```\n\nOr many points manually:\n\n```{r}\n\nlatitudes = c(53.464987, 53.472726, 53.466649) \nlongitudes = c(-2.230899, -2.245481, -2.243421) \npopups = c(\"You are here\", \"Here is another point\", \"Here is another point\") \ndf = data.frame(latitudes, longitudes, popups)      \n\nm <- leaflet(data = df) %>%\n  addTiles()  %>%  \n  addMarkers(lng=~longitudes, lat=~latitudes, popup=~popups)\nm  \n```\n\n##Change the basemap\n\nYou can change the background as well. You can find a list of different basemaps [here](http://leaflet-extras.github.io/leaflet-providers/preview/index.html).\n\n```{r}\nm <- leaflet(data = df) %>%\n  addProviderTiles(\"Stamen.Toner\") %>% \n  addMarkers(lng=~longitudes, lat=~latitudes, popup=~popups)\nm  \n```\n\n\n##Adding data from elsewhere\n\nYou will most likely want to add data to your map form external sources, rather than manually creating points. \n\nFor example, I illustrate here with data from [Manchester Open Data](http://open.manchester.gov.uk/) about public toilets: \n\n```{r}\npublicToilets <- read.csv(\"http://www.manchester.gov.uk/open/download/downloads/id/171/public_toilets.csv\")\n```\n\nOften spatial data will not come with latitude/longitude format, but with easting and northing. Leaflet (as far as I know) prefers lat/long so we might have to convert from BNG to WGS84. \n\nFirst thing we might notice is that the coordinates are in Easting and Northing format, rather than Latitude/ Longitude: \n\n```{r}\npublicToilets[,8:9]\n```\n\nThere is a comprehensive step-by-step tutorial on converting coordinates [here](http://www.alex-singleton.com/R-Tutorial-Materials/7-converting-coordinates.pdf). I'll just briefly demo this here.\n\n##Reprojecting coordinates\n\n\n```{r}\n#the library I'm using here is rgdal\nlibrary(rgdal)\n\n#these are the variables for the coordinate system types\nbng = \"+init=epsg:27700\"\nlatlong = \"+init=epsg:4326\"\n\n#create coords\ncoords <- cbind(Easting = as.numeric(as.character(publicToilets$GeoX)),\n                Northing = as.numeric(as.character(publicToilets$GeoY)))\n\n# create a SpatialPointsDataFrame\npublicToiletsSPDF <- SpatialPointsDataFrame(coords, data = publicToilets, proj4string = CRS(bng))\n\n#reproject with spTransform\npublicToiletsSPDF_latlng <- spTransform(publicToiletsSPDF, CRS(latlong))\n\n#extract coords into a column\npublicToiletsSPDF_latlng@data$lng <- publicToiletsSPDF_latlng@coords[,1]\npublicToiletsSPDF_latlng@data$lat <- publicToiletsSPDF_latlng@coords[,2]\n\n```\n\nNow you should have a reprojected spatial points data frame with latitude and longitude, ready to be mapped: \n\n```{r}\nm <- leaflet(data = publicToiletsSPDF_latlng@data) %>%\n  addProviderTiles(\"Stamen.Toner\")  %>%  \n  addMarkers(lng=~lng, lat=~lat, popup=~LocationText)\nm  \n```\n\n\n\n",
    "created" : 1516899449262.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3446019070",
    "id" : "908056A5",
    "lastKnownWriteTime" : 1516899475,
    "last_content_update" : 1516899475463,
    "path" : "~/Dropbox (The University of Manchester)/31152_60142 GIS and Crime Mapping/2018_labs/Third_session.Rmd",
    "project_path" : "Third_session.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}